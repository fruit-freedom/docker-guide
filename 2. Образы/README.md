Для создания собственных образов используется `Dockerfile`.
Докерфайл представляет из себя набор декларативных инструкций при выполнении которых \
происходит сборка нового образа. Сборкой образа занимается докер демон.

Ниже приведен пример сборки контейнера для сервера на языке Python.

```
FROM python:3.9

WORKDIR /code

COPY ./requirements.txt requirements.txt

RUN pip install --no-cache-dir --upgrade -r requirements.txt

COPY ./app /code/app

CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "80"]
```

Разберемся подробнее что здесь происходит.

В первой строчке командой `FROM` указываем от какого образа мы хотим унаследовать наш образ. Каждый образ должен быть наследником одного из базовых образов предоставляемых докером.
Докерфайл обязан начинаться с этой команды.

```
FROM python:3.9
```
В нашем случае мы берем как базу образ `python:3.9`. Что означает что мы берем образ python версии `3.9`.
Этот образ не является базовым, однако явялется оффициальным образом python что означает наличие интерпертатора внутри образа.

Далее следует команда `WORKDIR`.
```
WORKDIR /code
```

Она используется для создания директории внутри образа.
В данном случае мы создаем папку `code` в корне файловый системы образа.

Далее следует команда `COPY`. Команда используется для копирования файлов или директорий внутрь образа. В нашем случае мы копируем файл в котором находится список необходимых нам пакетов (Это специфика работы с библиотеками в `Python`).
В данном случае мы копируем файлв текущую папку (то есть папку которая была установлена командой `WORKDIR`)

```
COPY ./requirements.txt requirements.txt
```

Далее следует команда `RUN`. Данная команду используется для выполнения команд. То что идет после команды `RUN` должно являться валидным `bash` выражением.
Часто при сборке образа необходимо установить зависимости, скомпилировать или сконфигурировать приложение или выполнить любую другую работу которое можно не выполнять при запуске образа.
В нашем случае мы работаем с `Python` и у нас нет необходимости что либо компилировать, однако нам необходимо установить зависисмости. Для этого в `Python` используется пакетный менеджер `pip`.
Следующая команда устанавливает пакеты указанные в файле `requirements.txt`.
```
RUN pip install --no-cache-dir --upgrade -r requirements.txt
```
> Обратите внимание, данная команда выполняется из директории которая была установлена командой `WORKDIR`, то есть в нашем случае `/app`. Именно поэтому мы можем таким образом ссылаться на файл `requirements.txt`

Далее идет команда которая копирует исходный код внутрь образа. В данном случае мы копируем папку `app` в папку `/code`.
```
COPY ./app /code/app
```

Далее идет команда CMD. Данный шаг необходим для установки точки входа в образ.
При старте контейнера будет запущен один процесск который выполнит ту команду, которую мы укажем в `CMD`. То есть в данном случае
```
CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "80"]
```
Начальный процесс выполнит команду `uvicorn app.main:app --host 0.0.0.0 --port 80` что явялется командой запуска нашего приложения. Здесь стоит отметить, что после выполнения этой команды контейнер останавливается (то есть как бы завершается). В нашем случае мы запускаем веб сервер, поэтому контейнер будет работать до момента принудительной остановки (то есть пока не будет остановлен пользователем).

Далее необходимо собрать образ. Для сборки образов используется команда `docker build`.
Перейдем в директорию текущего урока и выполним команду

```
docker build -t server .
```

Флаг `-t` отвечает за названия образа (tag). В команде `docker build` есть один обязательный аргумент - контекст `.`.
Контекст отвечает за то относительно какой директориии будет идти сборка образа.
Ранее мы указывали в команде копирования файлы, которые хотим скопировать в обрах. При сборке докер будет искать эти файлы
относительно директориии указанный как конткст.

После выполнения команды увидим примерно следующий лог
```
[+] Building 4.1s (10/10) FINISHED                                                                                                                                    docker:default
 => [internal] load .dockerignore
 => => transferring context: 2B
 => [internal] load build definition from Dockerfile
 => => transferring dockerfile: 265B
 => [internal] load metadata for docker.io/library/python:3.9
 => CACHED [1/5] FROM docker.io/library/python:3.9@sha256:223acdfdcdb385208cf4dbe886f5da9009ec91ecc15550e5b1c70ba0d554735e
 => [internal] load build context
 => => transferring context: 123B
 => [2/5] WORKDIR /code
 => [3/5] COPY ./requirements.txt requirements.txt
 => [4/5] RUN pip install --no-cache-dir --upgrade -r requirements.txt
 => [5/5] COPY ./app /code/app
 => exporting to image
 => => exporting layers
 => => writing image sha256:62669c8f729a263541eadc7d1829995d39bd341cb8d0df62a8ae37d9d1865a16
 => => naming to docker.io/library/server
```

При вызове команды `docker images` будет виден наш собранный образ.
```
REPOSITORY                     TAG               IMAGE ID       CREATED          SIZE
server                         latest            62669c8f729a   10 minutes ago   1.02GB
```

Далее запустим контейнер на базе нашего образа командой
```
docker run server
```

И увидим в консоле следующий текст
```
INFO:     Started server process [1]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:80 (Press CTRL+C to quit)
```
Веб сервер готов!

Для остновки можно использовать следующее сочетание клавишь `CTRL+C`.

